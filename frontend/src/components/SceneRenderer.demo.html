<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SceneRenderer Demo - æº¶æ´åœºæ™¯æ¸²æŸ“å™¨æ¼”ç¤º</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft YaHei', sans-serif;
      overflow: hidden;
      background: #000;
    }

    #demo-canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }

    .controls {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      color: #fff;
      max-width: 300px;
      backdrop-filter: blur(10px);
    }

    .controls h2 {
      margin-bottom: 15px;
      font-size: 18px;
      color: #d4c4a8;
    }

    .controls button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      background: #3d2a4d;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }

    .controls button:hover {
      background: #4d3a5d;
    }

    .controls button:active {
      background: #2d1a3d;
    }

    .info {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      font-size: 12px;
      line-height: 1.6;
      color: #ccc;
    }

    .info p {
      margin: 5px 0;
    }

    .status {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px 20px;
      border-radius: 10px;
      color: #d4c4a8;
      backdrop-filter: blur(10px);
      font-size: 14px;
    }
  </style>
</head>
<body>
  <canvas id="demo-canvas"></canvas>

  <div class="controls">
    <h2>ğŸ® åœºæ™¯æ§åˆ¶</h2>
    <button id="btn-render">é‡æ–°æ¸²æŸ“åœºæ™¯</button>
    <button id="btn-add-point">æ·»åŠ äº¤äº’ç‚¹</button>
    <button id="btn-hover-point">æ¨¡æ‹Ÿæ‚¬åœæ•ˆæœ</button>
    <button id="btn-complete-point">æ ‡è®°ä¸ºå·²å®Œæˆ</button>
    <button id="btn-reset">é‡ç½®æ‰€æœ‰äº¤äº’ç‚¹</button>

    <div class="info">
      <p><strong>åŠŸèƒ½ç‰¹æ€§:</strong></p>
      <p>âœ… æ·±è“æš—ç´«è‰²è°ƒèƒŒæ™¯</p>
      <p>âœ… é’Ÿä¹³çŸ³å‚å æ•ˆæœ</p>
      <p>âœ… çŸ³ç¬‹åº•éƒ¨ç²—å£®</p>
      <p>âœ… çŸ³æŸ±è‡ªç„¶è¡”æ¥</p>
      <p>âœ… å…‰å½±æ¸å˜æ•ˆæœ</p>
      <p>âœ… äº¤äº’ç‚¹çŠ¶æ€å˜åŒ–</p>
    </div>
  </div>

  <div class="status">
    <span id="status-text">åœºæ™¯æ¸²æŸ“å™¨å·²å°±ç»ª</span>
  </div>

  <script type="module">
    // å¯¼å…¥ SceneRenderer
    import { SceneRenderer } from './SceneRenderer.js';

    // è·å–å…ƒç´ 
    const canvas = document.getElementById('demo-canvas');
    const statusText = document.getElementById('status-text');

    // åˆ›å»ºæ¸²æŸ“å™¨å®ä¾‹
    const renderer = new SceneRenderer();

    // åˆå§‹åŒ–æ¸²æŸ“å™¨
    renderer.initialize(canvas);
    renderer.render();

    // æ›´æ–°çŠ¶æ€
    function updateStatus(message) {
      statusText.textContent = message;
      console.log(message);
    }

    updateStatus('âœ… åœºæ™¯æ¸²æŸ“å®Œæˆ');

    // æ·»åŠ åˆå§‹äº¤äº’ç‚¹
    const initialPoints = [
      { id: 'p1', x: 0.2, y: 0.3, state: 'active', questionId: 'q1' },
      { id: 'p2', x: 0.4, y: 0.5, state: 'active', questionId: 'q2' },
      { id: 'p3', x: 0.6, y: 0.4, state: 'active', questionId: 'q3' },
      { id: 'p4', x: 0.8, y: 0.6, state: 'active', questionId: 'q4' },
    ];

    initialPoints.forEach(point => {
      renderer.addInteractionPoint(point);
    });

    updateStatus(`âœ… å·²æ·»åŠ  ${initialPoints.length} ä¸ªäº¤äº’ç‚¹`);

    // æŒ‰é’®äº‹ä»¶å¤„ç†
    document.getElementById('btn-render').addEventListener('click', () => {
      renderer.render();
      updateStatus('ğŸ¨ åœºæ™¯å·²é‡æ–°æ¸²æŸ“');
    });

    document.getElementById('btn-add-point').addEventListener('click', () => {
      const newPoint = {
        id: `p${Date.now()}`,
        x: Math.random() * 0.8 + 0.1,
        y: Math.random() * 0.8 + 0.1,
        state: 'active',
        questionId: `q${Date.now()}`
      };

      renderer.addInteractionPoint(newPoint);
      updateStatus(`â• æ·»åŠ æ–°äº¤äº’ç‚¹: (${(newPoint.x * 100).toFixed(0)}%, ${(newPoint.y * 100).toFixed(0)}%)`);
    });

    document.getElementById('btn-hover-point').addEventListener('click', () => {
      if (renderer.interactionPoints.length > 0) {
        const randomPoint = renderer.interactionPoints[
          Math.floor(Math.random() * renderer.interactionPoints.length)
        ];
        renderer.updateInteractionPoint(randomPoint.id, 'hover');
        updateStatus(`ğŸ‘† äº¤äº’ç‚¹ ${randomPoint.id} è¿›å…¥æ‚¬åœçŠ¶æ€`);
      } else {
        updateStatus('âš ï¸ æ²¡æœ‰å¯ç”¨çš„äº¤äº’ç‚¹');
      }
    });

    document.getElementById('btn-complete-point').addEventListener('click', () => {
      if (renderer.interactionPoints.length > 0) {
        const randomPoint = renderer.interactionPoints[
          Math.floor(Math.random() * renderer.interactionPoints.length)
        ];
        renderer.updateInteractionPoint(randomPoint.id, 'completed');
        updateStatus(`âœ… äº¤äº’ç‚¹ ${randomPoint.id} å·²æ ‡è®°ä¸ºå®Œæˆ`);
      } else {
        updateStatus('âš ï¸ æ²¡æœ‰å¯ç”¨çš„äº¤äº’ç‚¹');
      }
    });

    document.getElementById('btn-reset').addEventListener('click', () => {
      renderer.interactionPoints.forEach(point => {
        renderer.updateInteractionPoint(point.id, 'active');
      });
      updateStatus('ğŸ”„ æ‰€æœ‰äº¤äº’ç‚¹å·²é‡ç½®ä¸ºæ´»è·ƒçŠ¶æ€');
    });

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', () => {
      renderer.handleResize();
      updateStatus('ğŸ“ ç”»å¸ƒå°ºå¯¸å·²è°ƒæ•´');
    });

    // ç›‘å¬é¼ æ ‡ç§»åŠ¨ï¼ˆæ¨¡æ‹Ÿäº¤äº’ç‚¹æ‚¬åœï¼‰
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width;
      const y = (e.clientY - rect.top) / rect.height;

      // æ£€æµ‹æ˜¯å¦æ‚¬åœåœ¨äº¤äº’ç‚¹ä¸Š
      let hoveredPoint = null;
      renderer.interactionPoints.forEach(point => {
        const distance = Math.sqrt(
          Math.pow((point.x - x) * canvas.width, 2) +
          Math.pow((point.y - y) * canvas.height, 2)
        );

        if (distance < 20) {
          hoveredPoint = point;
        }
      });

      // æ›´æ–°æ‰€æœ‰äº¤äº’ç‚¹çŠ¶æ€
      renderer.interactionPoints.forEach(point => {
        if (point.state !== 'completed') {
          if (point === hoveredPoint) {
            if (point.state !== 'hover') {
              renderer.updateInteractionPoint(point.id, 'hover');
            }
          } else {
            if (point.state === 'hover') {
              renderer.updateInteractionPoint(point.id, 'active');
            }
          }
        }
      });
    });

    // ç›‘å¬ç‚¹å‡»äº‹ä»¶
    canvas.addEventListener('click', (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width;
      const y = (e.clientY - rect.top) / rect.height;

      // æ£€æµ‹ç‚¹å‡»çš„äº¤äº’ç‚¹
      renderer.interactionPoints.forEach(point => {
        const distance = Math.sqrt(
          Math.pow((point.x - x) * canvas.width, 2) +
          Math.pow((point.y - y) * canvas.height, 2)
        );

        if (distance < 20) {
          if (point.state === 'completed') {
            renderer.updateInteractionPoint(point.id, 'active');
            updateStatus(`ğŸ”„ äº¤äº’ç‚¹ ${point.id} å·²é‡æ–°æ¿€æ´»`);
          } else {
            renderer.updateInteractionPoint(point.id, 'completed');
            updateStatus(`âœ… äº¤äº’ç‚¹ ${point.id} å·²å®Œæˆ`);
          }
        }
      });
    });

    // æ¸…ç†èµ„æº
    window.addEventListener('beforeunload', () => {
      renderer.dispose();
    });
  </script>
</body>
</html>
